import sys, os ; sys.path.insert(0,os.path.dirname(os.path.dirname(__file__)))
from datetime import datetime
import requests
import urllib3
import time
import json
import sys
import logging

logging.basicConfig(level=logging.DEBUG, filename="logfile", filemode="a+", format="%(asctime)-15s %(levelname)-8s %(message)s")

http = urllib3.PoolManager(cert_reqs='CERT_NONE')
urllib3.disable_warnings()

class Camunda():

    def __init__(self,parameters,environment_blz): 
        
        self.url_blaze_dev = '/engine-rest'
        self.url_blaze_pro = '/engine-rest'
        self.url_blaze_pre = '/engine-rest'
        self.url_blaze_stg = '/engine-rest'
        self.environment = environment_blz
        self.parameter = parameters
        
    def deployment_workflow(self,unique_id):    
        
        """ Realiza a implantação do arquivo BPMN """

        logging.debug('Realizando deployment do arquivo BPMN')
        
        try:
            if self.environment.upper() == "PRO":
                url = self.url_blaze_pro
            elif self.environment.upper() == "PRE":
                url = self.url_blaze_pre
            elif self.environment.upper() == "STG":
                url = self.url_blaze_stg    
            elif self.environment.upper() == "DEV":
                url = self.url_blaze_dev
            else:
                url = None    

            params = {
                 'deployment-name' : 'BLZ 1.0 Migration: '+ unique_id.split('.')[0],
                 'enable-duplicate-filtering': 'false',
                 'deploy-changed-only' : 'true',
                 'deployment-source' : 'BLZ 1.0 Migration',
            }
            file = {
                'data' : open(unique_id,'rb')
            } 
            r = requests.post(url=url + '/deployment/create',params=params,files=file,verify=False,timeout=5)
            r.raise_for_status()
            return True    
        except Exception as error:
            message = 'Falha na linha: ' + str(format(sys.exc_info()[-1].tb_lineno)) + ' | Descricao: ' + str(error)
            logging.info('' + str(message))
            return False
        
    def create_bpmn_file(self,xml_string,unique_id):
        
        """ Realiza a criação de um novo arquivo BPMN """

        logging.debug('Criando novo arquivo BPMN')
        
        try: 
            with open(unique_id, 'w', encoding='utf-8') as file:
                file.write(xml_string)
            return True
        except Exception as error:
            message = 'Falha na linha: ' + str(format(sys.exc_info()[-1].tb_lineno)) + ' | Descricao: ' + str(error)
            logging.info('' + str(message))
            return False
    
    def remove_bpmn_file(self):
        
        """ Realiza a exclusão de arquivo(s) BPMN """

        logging.debug('Removendo ultima versão do arquivo BPMN criado')
        
        try:
            for file in os.listdir('./'):
                if file.endswith('.bpmn'):
                    os.remove(file)
                    time.sleep(1.5)
            return True
        except Exception as error:
            message = 'Falha na linha: ' + str(format(sys.exc_info()[-1].tb_lineno)) + ' | Descricao: ' + str(error)
            logging.info('' + str(message))
            return False        